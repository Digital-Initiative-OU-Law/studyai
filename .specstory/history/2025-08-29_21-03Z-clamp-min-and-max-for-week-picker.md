<!-- Generated by SpecStory -->

# Clamp min and max for week picker (2025-08-29 21:03Z)

_**User**_

In frontend/components/WeekPicker.tsx around lines 13 to 15, the weeks array creation uses Array.from({ length: max - min + 1 }) which will throw or produce negative length when min > max; clamp min and max to safe values (e.g., ensure min <= max by swapping or setting length = Math.max(0, max - min + 1)) and memoize the computed weeks with useMemo based on [min, max] (and value if needed) to avoid recalculation; update the component to derive a safeMin/safeMax, compute a non-negative length, map to weeks, and wrap the computation in useMemo.

---

_**Assistant**_

I'll examine the WeekPicker component and fix the array creation issue with proper bounds checking and memoization.


---

Read file: frontend/components/WeekPicker.tsx

---

Now I'll fix the component by adding proper bounds checking, safe array length calculation, and memoization:


---

<details><summary>Edit file: frontend/components/WeekPicker.tsx</summary>

I'm adding useMemo import, implementing safe bounds checking with safeMin/safeMax, computing a non-negative length, and wrapping the weeks computation in useMemo to prevent unnecessary recalculations.

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -1,4 +1,5 @@
  'use client';
  
+ import { useMemo } from 'react';
  import { Card, CardContent, CardHeader, CardTitle } from './ui/card';
  import { Calendar } from 'lucide-react';
```

**Chunk 2**
Lines added: 7, lines removed: 1

```diff
@@ -12,5 +13,11 @@
  
  export default function WeekPicker({ value, onChange, min = 1, max = 16 }: WeekPickerProps) {
-   const weeks = Array.from({ length: max - min + 1 }, (_, i) => min + i);
+   const weeks = useMemo(() => {
+     const safeMin = Math.min(min, max);
+     const safeMax = Math.max(min, max);
+     const length = Math.max(0, safeMax - safeMin + 1);
+     
+     return Array.from({ length }, (_, i) => safeMin + i);
+   }, [min, max]);
  
    return (
```

</details>

---

Perfect! I've successfully updated the WeekPicker component with the following improvements:

1. **Added `useMemo` import** from React
2. **Implemented safe bounds checking**:
   - `safeMin = Math.min(min, max)` ensures the smaller value is always first
   - `safeMax = Math.max(min, max)` ensures the larger value is always second
3. **Computed non-negative length** with `Math.max(0, safeMax - safeMin + 1)` to prevent negative array lengths
4. **Wrapped computation in `useMemo`** with dependencies `[min, max]` to avoid unnecessary recalculations when other props change

The component now safely handles cases where `min > max` by automatically swapping the values, and the array length will never be negative. The memoization ensures the weeks array is only recalculated when `min` or `max` values actually change, improving performance.

---

